

<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Trang chu</title>
<link
	href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap"
	rel="stylesheet">

<link
	href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&display=swap"
	rel="stylesheet">

<link
	href="https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,600&display=swap"
	rel="stylesheet">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">
<link rel="stylesheet"
	href=”https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css” />

<link th:href="@{/assets2/08/fonts/icomoon/style.css}" rel="stylesheet" />
<link th:href="@{/assets2/08/css/owl.carousel.min.css}" rel="stylesheet" />
<link th:href="@{/assets2/08/css/bootstrap.min.css}" rel="stylesheet" />

<link rel="stylesheet" th:href="@{/assets/css/dangKiCaNhan.css}">
<link th:href="@{/assets2/08/css/style.css}" rel="stylesheet" />
<link th:href="@{/assets2/css/errorValidate.css}" rel="stylesheet" />
<link href="//cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css"
	rel="stylesheet" />
<script th:src="@{/assets2/js/dangKiCaNhan.js}"></script>
<link th:href="@{/assets2/css/FormCss.css}" rel="stylesheet" />
<!-- Bootstrap CSS v5.2.1 -->

</head>
<body>
	<div th:replace="fragments::link_css"></div>
	<div th:replace="fragments::admin_navbar"></div>
	<div th:replace="fragments::admin_sidebar"></div>
	<main>
		<div class="site-section">

			<div class="container-fluid">
				<div class="row justify-content-center">
					<div class="col-md-9">
						<!-- start code here -->


						<div class="border" id="results">


							<div th:replace="fragments::modal_add_muc_thue_toan_phan"></div>

							<div
								class="main-content d-flex justify-content-center flex-column"
								style="height: 100vh;">
								<h1>Chức năng cấu hình biểu thuế toàn phần</h1>
								<p id="messagebttp" style="color: red; font-style: italic"></p>
								<div class="btn-container">
									<button class="btn btn-info" data-bs-toggle="modal"
										data-bs-target="#model_muc_thue_toan_phan"
										onclick="setStatusToCreate()">Thêm mức thuế</button>
								</div>
								<table style="" class="table table-bordered">
									<thead>

										<th>Thu nhập tính thuế</th>
										<th>Thuế suất</th>
										<th></th>
									</thead>
									<tbody>
										<tr th:each="item,state:${bieuThueToanPhan}">
											<td th:text="${item.thunhaptinhthue}"></td>
											<td th:text="${item.thuesuat}"></td>
											<td><a class="btn btn-warning" href="#"
												th:onclick="processModifyMucThue([[${item.id_bieuthuetoanphan}]])">Modify</a>
												<button
													th:onclick="showAlertDeleteMucThue([[${item.id_bieuthuetoanphan}]])"
													class="btn btn-danger">Xóa mức thuế</button></td>

										</tr>


									</tbody>
								</table>
								<div class="btn-container">
									<button class="btn btn-success" onclick="reloadPage()">Refresh</button>

									<div th:replace="fragments::modal_delete_alert"></div>
								</div>
							</div>

							<!-- end of content -->
						</div>
					</div>
				</div>
			</div>
	</main>
	<script th:src="@{/assets2/08/js/jquery-3.3.1.min.js}"></script>
	<script th:src="@{/assets2/08/js/popper.min.js}"></script>
	<script th:src="@{/assets2/08/js/bootstrap.min.js}"></script>
	<script th:src="@{/assets2/08/js/main.js}"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.18.0/additional-methods.js"></script>

	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
		integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
		crossorigin="anonymous"></script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
		integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
		crossorigin="anonymous"></script>

	<script>
		function setStatusToCreate(){
			$("#txt_thu_nhap_tinh_thue_tp").val("");
			$("#txt_thue_suat_toan_phan").val("");
			$("#type_of_modal").val("create");
			$("#btn-tao-moi-muc-thue").text("Tạo mới mức thuế");
			$("#staticBackdropLabel").text("Tạo mới mức thuế");
		}
		function reloadPage(){
			location.reload();
		}
		function showAlertDeleteMucThue(id){
			$("#model_delete_alert").modal('show');
			$("#id_muc_thue_se_xoa").val(id);
			
			
			}
		$("#btn_confirm_delete_muc_thue").click(function(){
				var id_muc_thue_se_xoa = $("#id_muc_thue_se_xoa").val();
				$.ajax({
					url:"/admin/apiXoaMocThueToanPhan/"+id_muc_thue_se_xoa,
					type:'GET',
					success:function(res){
						alert('xóa mốc thuế thành công');
						$("#model_delete_alert").modal('hide');
						location.reload();
						},
						error:function(err){
						alert('lỗi khi xóa mốc thuế');
						$("#model_delete_alert").modal('hide');
						}
					});
			});
			
		
		function initFormTaoMucThue(){
			$("#staticBackdrop").modal("show");
			$("#type_of_modal").val("create");
			$("#btn-tao-moi-muc-thue").text("Tạo mới mức thuế");
			 $("#staticBackdropLabel").text("Tạo mới mức thuế");
			$("#txt_bac_thue").val("");
			$("#txt_phan_thu_nhap_theo_nam").val("");
			$("#txt_phan_thu_nhap_theo_thang").val("");
			$("#txt_thue_suat").val("");
			
		}
		function processModifyMucThue(id){
			$("#txt_id_muc_thue_toan_phan").val(id);
			$("#staticBackdropLabel").text("Cập nhật mức thuế");
				$.ajax({
					url:"/admin/getBTTPById",
					type:"GET",
					dataType:"json",
					data:{
						id:id
					},
					success: function(item){
						console.log(item);
						$("#model_muc_thue_toan_phan").modal("show");
						$("#type_of_modal").val("update");
						$("#btn-tao-moi-muc-thue").text("Cập nhật mức thuế");
						$("#txt_thu_nhap_tinh_thue_tp").val(item.thunhaptinhthue);
						$("#txt_thue_suat_toan_phan").val(item.thuesuat);
						
					},
					error:function(error){
						alert('không lấy được id biểu thuế lũy tiến');
					}
					})
				}
	      function processTaoMoiMucThue() {
		  debugger;
	        var thunhaptinhthue = $("#txt_thu_nhap_tinh_thue_tp").val();
	        var thuesuat=$("#txt_thue_suat_toan_phan").val();
	        var bttp = {
	        		 id_bieuthuetoanphan:'',
	           	 	 thunhaptinhthue:thunhaptinhthue,
	           	 	 thuesuat:thuesuat
	                }
	        
	        if($("#type_of_modal").val()=='create'){
	        	 $.ajax({
	                 url: "/admin/apiThemMucThueToanPhan",
	                 type: "POST",
	                 contentType: "application/json",
	                 data: JSON.stringify(bttp),
	                 success: function (response) {
	               	  $("#model_muc_thue_toan_phan").modal("hide");
	                     var element = $("<div>", {
	                       class: "error-message",
	                       text: "thêm mới thành công. Reload lại trang để cập nhật",
	                     });
	                     $("#messagebttp").append(element);
	                     element.show();
	                     setTimeout(function () {
	                       element.hide();
	                     }, 3000);
	                     },
	                 error: function (error) {
	       				alert('có lỗi xảy ra');
	                     },
	               });

	            }
            
	        else if($("#type_of_modal").val()=='update'){
	           	var id_muc_thue = $("#txt_id_muc_thue_toan_phan").val();
	           	var thunhaptinhthue = $("#txt_thu_nhap_tinh_thue_tp").val();
		      	var thuesuat=$("#txt_thue_suat_toan_phan").val();
	        	var bttp = {
	        			id_bieuthuetoanphan:id_muc_thue,
	              	 	thuesuat:thuesuat,
	                    thunhaptinhthue:thunhaptinhthue,
	                    
	                   }
	        	 $.ajax({
	                 url: "/admin/apiUpdateMucThueToanPhan",
	                 type: "POST",
	                 contentType: "application/json",
	                 data: JSON.stringify(bttp),
	                 success: function (response) {
	               	  $("#model_muc_thue_toan_phan").modal("hide");
	                     var element = $("<div>", {
	                       class: "error-message",
	                       text: "cập nhật thành công. Reload lại trang để cập nhật",
	                     });
	                     $("#messagebttp").append(element);
	                     element.show();
	                     setTimeout(function () {
	                       element.hide();
	                     }, 3000);
	                     },
	                 error: function (error) {
	       				alert('có lỗi xảy ra');
	                     },
	               });
	        }
	       
	      }
			
		</script>




</body>
</html>

